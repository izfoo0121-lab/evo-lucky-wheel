<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>EVO Roda Bertuah</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
}

.container{
  background:#fff;
  border-radius:24px;
  padding:36px 28px;
  width:100%;
  max-width:480px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
  text-align:center;
}

h1{
  font-size:28px;
  margin-bottom:6px;
}

.subtitle{
  display:inline-block;
  font-size:14px;
  background:#ffeaa7;
  padding:6px 14px;
  border-radius:20px;
  margin-bottom:24px;
}

input{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:12px;
  border:2px solid #ddd;
  margin-bottom:22px;
}

#wheel-container{
  position:relative;
  width:300px;
  height:300px;
  margin:0 auto 24px;
}

#wheel{
  width:100%;
  height:100%;
  border-radius:50%;
  border:10px solid #333;
  transition:transform 4s cubic-bezier(.25,.1,.25,1);
}

.pointer{
  position:absolute;
  top:-14px;
  left:50%;
  transform:translateX(-50%);
  width:0;height:0;
  border-left:18px solid transparent;
  border-right:18px solid transparent;
  border-bottom:32px solid red;
  z-index:10;
}

.center{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:58px;height:58px;
  border-radius:50%;
  background:linear-gradient(135deg,#667eea,#764ba2);
  border:4px solid #fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
}

button{
  width:100%;
  padding:16px;
  font-size:18px;
  font-weight:bold;
  border:none;
  border-radius:40px;
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#fff;
  cursor:pointer;
}

button:disabled{
  background:#aaa;
  cursor:not-allowed;
}

.footer{
  font-size:12px;
  color:#777;
  margin-top:18px;
}
</style>
</head>

<body>

<div class="container">
  <h1>üéâ EVO Roda Bertuah üéâ</h1>
  <div class="subtitle">Kedai Baharu ¬∑ Pasti ‚â• 1 Paket TR12 / CM</div>

  <input id="debtorCode" placeholder="Masukkan Kod Debtor" />

  <div id="wheel-container">
    <div class="pointer"></div>
    <canvas id="wheel" width="300" height="300"></canvas>
    <div class="center">üéÅ</div>
  </div>

  <button id="spinBtn">Putar Sekarang</button>

  <div class="footer">
    ‚Ä¢ Setiap Debtor hanya 1 kali<br>
    ‚Ä¢ Hadiah diberi bersama pesanan seterusnya
  </div>
</div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const debtorInput = document.getElementById("debtorCode");

/* =========================
   UI Âå∫ÂùóÔºàÂøÖÈ°ªÂåÖÂê´ CTNÔºâ
========================= */
const rewards = [
  "TR12 / CM - 1 paket",
  "TR12 / CM - 2 paket",
  "TR12 / CM - 3 paket",
  "üéâ TR12 / CM - 1 CTN (10 paket)"
];

/* =========================
   ÂÆûÈôÖÊ¶ÇÁéáÔºà2% CTNÔºâ
========================= */
const probabilityPool = [
  { prize: rewards[0], weight: 75 },
  { prize: rewards[1], weight: 15 },
  { prize: rewards[2], weight: 8 },
  { prize: rewards[3], weight: 2 }
];

let currentRotation = 0;

/* ÁîªËΩ¨Áõò */
function drawWheel(){
  const arc = Math.PI*2/rewards.length;
  const colors=["#FFD966","#7FDBB6","#74B9FF","#FF7675"];

  rewards.forEach((text,i)=>{
    ctx.beginPath();
    ctx.fillStyle=colors[i];
    ctx.moveTo(150,150);
    ctx.arc(150,150,150,arc*i,arc*(i+1));
    ctx.fill();

    ctx.save();
    ctx.translate(150,150);
    ctx.rotate(arc*i+arc/2);
    ctx.textAlign="right";
    ctx.font="bold 13px Arial";
    ctx.fillStyle="#333";
    ctx.fillText(text,140,5);
    ctx.restore();
  });
}

/* Âä†ÊùÉÊäΩÂ•ñ */
function weightedRandom(){
  let total=probabilityPool.reduce((s,p)=>s+p.weight,0);
  let r=Math.random()*total;
  for(const p of probabilityPool){
    if(r<p.weight) return p.prize;
    r-=p.weight;
  }
}

spinBtn.onclick=()=>{
  const debtor=debtorInput.value.trim();
  if(!debtor){alert("ËØ∑ËæìÂÖ• Debtor Code");return;}

  const key="EVO_SPIN_"+debtor;
  if(localStorage.getItem(key)){
    alert("Debtor Â∑≤ÂèÇ‰∏éËøá üôè");
    return;
  }

  const result=weightedRandom();
  const index=rewards.indexOf(result);
  const arc=360/rewards.length;

  currentRotation+=360*5+(360-(index*arc+arc/2))+90;
  canvas.style.transform=`rotate(${currentRotation}deg)`;

  spinBtn.disabled=true;
  spinBtn.textContent="Memutar...";
  localStorage.setItem(key,"played");

  setTimeout(()=>{
    fetch("https://script.google.com/macros/s/AKfycbyOEKmkjczMpTcBGUXBoVMrv5IuhAuNro4upiT85ueONZ6P2FXcp9zOJCeYCrOAcZi4/exec",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        debtor:debtor,
        reward:result,
        source:"EVO_WHEEL_TR12_CM"
      })
    });

    alert(
      "üéâ Tahniah!\n\n"+
      "Kod Debtor: "+debtor+
      "\n\nHadiah Anda:\n"+result+
      "\n\nHadiah akan diberi bersama pesanan seterusnya."
    );

    spinBtn.textContent="Sudah Menyertai";
  },4200);
};

drawWheel();
</script>

</body>
</html>

