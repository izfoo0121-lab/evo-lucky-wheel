<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EVO Roda Bertuah</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',Tahoma,sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
}
.card{
  background:#fff;
  max-width:420px;
  width:100%;
  border-radius:28px;
  padding:32px 28px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
}
h1{margin-bottom:12px;font-size:24px}
.badge{
  background:linear-gradient(135deg,#ffd89b,#19547b);
  color:#fff;
  padding:8px 18px;
  border-radius:25px;
  display:inline-block;
  margin-bottom:24px;
  font-size:13px;
  font-weight:600;
}
.wheel-wrapper{
  position:relative;
  width:300px;
  height:300px;
  margin:0 auto 28px;
}
.arrow{
  position:absolute;
  top:-12px;
  left:50%;
  transform:translateX(-50%);
  width:0;height:0;
  border-left:18px solid transparent;
  border-right:18px solid transparent;
  border-top:28px solid #ff4757;
  z-index:10;
}
svg{
  width:100%;
  height:100%;
  border-radius:50%;
  border:8px solid #333;
  transition:transform 4.5s cubic-bezier(0.17,0.67,0.12,0.99);
  will-change:transform;
}
.center{
  position:absolute;
  width:70px;
  height:70px;
  background:#fff;
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:5;
  box-shadow:0 4px 15px rgba(0,0,0,.2);
}
input,button{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  font-size:16px;
}
input{
  border:2px solid #eee;
  margin-bottom:20px;
}
button{
  background:#764ba2;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
button:disabled{background:#ccc}
.note{margin-top:15px;font-size:12px;color:#666}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  z-index:100;
  justify-content:center;
  align-items:center;
}
.modal.show{display:flex}
.modal-content{
  background:#fff;
  padding:30px;
  border-radius:20px;
  width:90%;
  max-width:320px;
  text-align:center;
}
</style>
</head>

<body>
<div class="card">
  <h1>üéâ EVO Roda Bertuah üéâ</h1>
  <div class="badge">Sila Masukkan Kod Debtor</div>
  <label for="debtor" style="display:none">Kod Debtor</label>
  <input id="debtor" placeholder="Contoh: D12345" />

  <div class="wheel-wrapper">
    <div class="arrow"></div>
    <svg id="wheel" viewBox="0 0 300 300">
      <g transform="translate(150,150)"></g>
    </svg>
    <div class="center">üéÅ</div>
  </div>

  <button id="spinBtn">Putar Sekarang</button>
  <div class="note">*Setiap Debtor hanya 1 kali peluang</div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <h2>Tahniah üéâ</h2>
    <p id="prizeText" style="margin:20px 0;font-size:18px;font-weight:bold;color:#764ba2"></p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxhNTgRhTZSe2LXrEl0EiPOeS79U_IC55ndcoSkTBSdkpVe3T4ys8e1babWWycqW9F2/exec";

// Â•ñÂìÅ + ÊùÉÈáçÔºàÊ¶ÇÁéáÔºâ
const prizes = [
  {text:"TR12 / CM 1 Paket",color:"#FFD93D",weight:40},
  {text:"TR12 / CM 2 Paket",color:"#6BCB77",weight:25},
  {text:"TR12 / CM 3 Paket",color:"#4D96FF",weight:20},
  {text:"TR12 / CM 1 Paket",color:"#FF6B6B",weight:10},
  {text:"TR12 / CM 1 Paket",color:"#A66CFF",weight:5}
];

const svg = document.querySelector("#wheel g");
const angle = 360 / prizes.length;
const r = 140;

// ÁªòÂà∂ÊâáÂå∫
function drawSegment(prize, index){
  const start = index * angle;
  const end = start + angle;
  const large = angle > 180 ? 1 : 0;

  const x1 = r * Math.cos(Math.PI * start / 180);
  const y1 = r * Math.sin(Math.PI * start / 180);
  const x2 = r * Math.cos(Math.PI * end / 180);
  const y2 = r * Math.sin(Math.PI * end / 180);

  const path = document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("d",`M0 0 L${x1} ${y1} A${r} ${r} 0 ${large} 1 ${x2} ${y2} Z`);
  path.setAttribute("fill",prize.color);
  svg.appendChild(path);

  const text = document.createElementNS("http://www.w3.org/2000/svg","text");
  const mid = start + angle/2;
  const tx = (r-35) * Math.cos(Math.PI * mid/180);
  const ty = (r-35) * Math.sin(Math.PI * mid/180);
  text.setAttribute("x",tx);
  text.setAttribute("y",ty);
  text.setAttribute("fill","#fff");
  text.setAttribute("font-size","14");
  text.setAttribute("font-weight","800");
  text.setAttribute("text-anchor","middle");
  text.setAttribute("dominant-baseline","middle");
  text.textContent = prize.text;
  svg.appendChild(text);
}
prizes.forEach(drawSegment);

let spinning = false;

// Âä†ÊùÉÈöèÊú∫ÈÄâÊã©Â•ñÂìÅ
function weightedRandom(){
  const total = prizes.reduce((sum,p)=>sum+p.weight,0);
  let rand = Math.random() * total;
  for(let i=0;i<prizes.length;i++){
    rand -= prizes[i].weight;
    if(rand <= 0) return i;
  }
  return prizes.length-1;
}

// Ê†°È™å Debtor Ê†ºÂºè
function validateDebtor(code){
  return /^D\d{5}$/.test(code);
}

async function spin(){
  if(spinning) return;
  const debtor = document.getElementById("debtor").value.trim();
  if(!validateDebtor(debtor)){
    alert("Kod Debtor tidak sah. Format: D12345");
    return;
  }

  spinning = true;
  document.getElementById("spinBtn").disabled = true;

  try{
    const check = await fetch(`${SCRIPT_URL}?check=${encodeURIComponent(debtor)}`)
      .then(r=>r.json());
    if(check.exists){
      alert("Debtor ini sudah pernah bermain");
      reset();
      return;
    }
  }catch(e){
    alert("Ralat rangkaian. Sila cuba lagi.");
    reset();
    return;
  }

  const index = weightedRandom();
  const target = index * angle + angle/2;
  const rotation = 360*6 - target - 90;

  document.getElementById("wheel").style.transform = `rotate(${rotation}deg)`;

  setTimeout(async()=>{
    document.getElementById("prizeText").innerText = prizes[index].text;
    document.getElementById("modal").classList.add("show");

    try{
      await fetch(SCRIPT_URL,{

Ó∑ôÓ∑ö
