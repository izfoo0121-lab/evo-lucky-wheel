<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EVO Roda Bertuah</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',Tahoma;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
}
.card{
  background:#fff;
  max-width:420px;
  width:100%;
  border-radius:28px;
  padding:32px 28px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
}
h1{margin-bottom:12px;font-size:24px}
.badge{
  background:linear-gradient(135deg,#ffd89b,#19547b);
  color:#fff;
  padding:8px 18px;
  border-radius:25px;
  display:inline-block;
  margin-bottom:24px;
  font-size:13px;
  font-weight:600;
}
.wheel-wrapper{
  position:relative;
  width:300px;
  height:300px;
  margin:0 auto 28px;
}
.arrow{
  position:absolute;
  top:-10px;
  left:50%;
  transform:translateX(-50%);
  width:0;height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-top:25px solid #ff4757;
  z-index:10;
}
.wheel{
  width:100%;height:100%;
  border-radius:50%;
  border:8px solid #333;
  overflow:hidden;
  transition:transform 4s cubic-bezier(.17,.67,.12,.99);
}
.segment{
  position:absolute;
  width:100%;height:100%;
  clip-path:polygon(50% 50%,100% 15%,100% 85%);
}
.segment span{
  position:absolute;
  right:15px;
  top:50%;
  transform:translateY(-50%);
  width:120px;
  text-align:right;
  color:#fff;
  font-weight:800;
  font-size:14px;
  text-shadow:1px 1px 3px rgba(0,0,0,.8);
}
.center{
  position:absolute;
  width:60px;height:60px;
  background:#fff;
  border-radius:50%;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:5;
}
input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:2px solid #eee;
  margin-bottom:20px;
  font-size:16px;
}
button{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  background:#764ba2;
  color:#fff;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
}
button:disabled{background:#ccc}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  z-index:100;
  justify-content:center;
  align-items:center;
}
.modal.show{display:flex}
.modal-content{
  background:#fff;
  padding:30px;
  border-radius:20px;
  width:80%;
  max-width:300px;
  text-align:center;
}
</style>
</head>

<body>

<div class="card">
  <h1>üéâ EVO Roda Bertuah üéâ</h1>
  <div class="badge">Sila Masukkan Kod Debtor</div>

  <input id="debtor" placeholder="Contoh: D12345" />

  <div class="wheel-wrapper">
    <div class="arrow"></div>
    <div id="wheel" class="wheel"></div>
    <div class="center">üéÅ</div>
  </div>

  <button id="spinBtn" onclick="spin()">Putar Sekarang</button>

  <div style="margin-top:15px;font-size:12px;color:#666">
    *Setiap Debtor hanya 1 kali peluang
  </div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <h2>Tahniah üéâ</h2>
    <p id="prizeText" style="margin:20px 0;font-size:18px;font-weight:bold;color:#764ba2"></p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbxlIyJpTqKsKoOjeNAuvZHDD5K49NBWE6OOeHrWDieGZzJbHO-CmSYELZslFXZVwVGh/exec";

const prizes=[
 {text:"TR12 / CM 1 Paket",color:"#FFD93D"},
 {text:"TR12 / CM 2 Paket",color:"#6BCB77"},
 {text:"TR12 / CM 1 Paket",color:"#FF6B6B"},
 {text:"TR12 / CM 3 Paket",color:"#4D96FF"},
 {text:"TR12 / CM 1 Paket",color:"#A66CFF"}
];

const wheel=document.getElementById("wheel");
const spinBtn=document.getElementById("spinBtn");
const modal=document.getElementById("modal");
const prizeText=document.getElementById("prizeText");

const total=prizes.length;
const anglePer=360/total;

// build wheel
prizes.forEach((p,i)=>{
  const seg=document.createElement("div");
  seg.className="segment";
  seg.style.background=p.color;
  seg.style.transform=`rotate(${i*anglePer}deg)`;
  const span=document.createElement("span");
  span.innerText=p.text;
  seg.appendChild(span);
  wheel.appendChild(seg);
});

let spinning=false;

async function spin(){
  if(spinning) return;

  const debtor=document.getElementById("debtor").value.trim();
  if(!debtor){alert("Sila masukkan Kod Debtor");return;}

  spinBtn.disabled=true;
  spinning=true;

  // ÂÖà check Google Sheet ÊòØÂê¶Â∑≤Â≠òÂú®
  const check=await fetch(`${SCRIPT_URL}?check=${encodeURIComponent(debtor)}`)
    .then(r=>r.json())
    .catch(()=>({exists:false}));

  if(check.exists){
    alert("Debtor ini sudah pernah bermain");
    spinning=false;
    spinBtn.disabled=false;
    return;
  }

  const index=Math.floor(Math.random()*total);

  const targetAngle=index*anglePer+anglePer/2;
  const finalRotation=360*5-targetAngle-90;
  wheel.style.transform=`rotate(${finalRotation}deg)`;

  setTimeout(async()=>{
    const prize=prizes[index].text;
    prizeText.innerText=prize;
    modal.classList.add("show");

    // ÂÜôÂÖ• Google Sheet
    await fetch(SCRIPT_URL,{
      method:"POST",
      body:JSON.stringify({
        debtor:debtor,
        prize:prize,
        page:location.href
      })
    });

    spinning=false;
    spinBtn.disabled=false;
  },4200);
}

function closeModal(){
  modal.classList.remove("show");
}
</script>

</body>
</html>

