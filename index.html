<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>EVO Roda Bertuah</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Segoe UI',Arial,sans-serif;
  background:
    radial-gradient(circle at top, rgba(255,255,255,0.15), transparent 40%),
    linear-gradient(135deg,#6a11cb,#2575fc);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
}

.container{
  background:rgba(255,255,255,0.96);
  border-radius:28px;
  padding:40px 28px 34px;
  width:100%;
  max-width:480px;
  box-shadow:0 30px 80px rgba(0,0,0,.35);
  text-align:center;
}

h1{
  font-size:28px;
  margin-bottom:10px;
  font-weight:800;
}

.subtitle{
  display:inline-block;
  font-size:13px;
  font-weight:600;
  background:linear-gradient(135deg,#ffe259,#ffa751);
  padding:8px 18px;
  border-radius:999px;
  margin-bottom:26px;
}

input{
  width:100%;
  padding:16px 18px;
  font-size:16px;
  border-radius:14px;
  border:2px solid #ddd;
  margin-bottom:26px;
}

#wheel-container{
  position:relative;
  width:300px;
  height:300px;
  margin:0 auto 26px;
}

.pointer{
  position:absolute;
  top:-14px;                 /* â¬…ï¸ è®©ç®­å¤´â€œå‹â€è¿›è½¬ç›˜ä¸€ç‚¹ */
  left:50%;
  transform:translateX(-50%);
  width:0;
  height:0;

  /* â¬‡ï¸ ä¸‰è§’å½¢å°–ç«¯å‘ä¸‹ */
  border-left:16px solid transparent;
  border-right:16px solid transparent;
  border-top:28px solid #ff3b3b;

  filter:drop-shadow(0 6px 8px rgba(0,0,0,.45));
  z-index:10;
}


#wheel-wrapper{
  width:300px;
  height:300px;
  transition:transform 4s cubic-bezier(.17,.67,.32,1.1);
}

#wheel{
  width:100%;
  height:100%;
  border-radius:50%;
  border:10px solid #2d2d2d;
  box-shadow:0 20px 40px rgba(0,0,0,.35);
}

.center{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:68px;height:68px;
  border-radius:50%;
  background:linear-gradient(135deg,#6a11cb,#2575fc);
  border:5px solid #fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
}

button{
  width:100%;
  padding:18px;
  font-size:18px;
  font-weight:800;
  border:none;
  border-radius:999px;
  background:linear-gradient(135deg,#6a11cb,#2575fc);
  color:#fff;
  cursor:pointer;
}

button:disabled{
  background:#aaa;
  cursor:not-allowed;
}

.footer{
  font-size:12px;
  color:#777;
  margin-top:20px;
}
</style>
</head>

<body>

<div class="container">
  <h1>ğŸ‰ EVO Roda Bertuah ğŸ‰</h1>
  <div class="subtitle">Kedai Baharu Â· Dijamin â‰¥ 1 Paket TR12 / CM</div>

  <input id="debtorCode" placeholder="Masukkan Kod Debtor" />
  <input id="invoiceNo" placeholder="Masukkan Invoice No (IV12345)" />

  <div id="wheel-container">
    <div class="pointer"></div>

    <div id="wheel-wrapper">
      <canvas id="wheel" width="300" height="300"></canvas>
    </div>

    <div class="center">ğŸ</div>
  </div>

  <button id="spinBtn" type="button">Putar Sekarang</button>

  <div class="footer">
    â€¢ Setiap Debtor hanya 1 kali<br>
    â€¢ Hadiah diberi bersama pesanan seterusnya
  </div>
</div>

<form
    id="gasForm"
    action="https://script.google.com/macros/s/AKfycbyMYK5-E4iv0uk0dI5sn8I002fd50Ky4DgWD7xC-a7SEFQmQoI9y2V-07me4KQAJg6c/exec"
    method="POST"
    target="hiddenFrame"
  >
    <input type="hidden" name="debtor">
    <input type="hidden" name="invoice">
    <input type="hidden" name="reward">
    <input type="hidden" name="source" value="EVO_WHEEL_TR12_CM">
  </form>
<iframe
  name="hiddenFrame"
  style="
    display:none;
    width:0;
    height:0;
    border:0;
  "
></iframe>


<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const wheelWrapper = document.getElementById("wheel-wrapper");
const spinBtn = document.getElementById("spinBtn");
const debtorInput = document.getElementById("debtorCode");
const invoiceInput = document.getElementById("invoiceNo");
  
const rewards = [
  "TR12 / CM - 1 paket",
  "TR12 / CM - 2 paket",
  "TR12 / CM - 3 paket",
  "ğŸ‰ TR12 / CM - 1 CTN (10 paket)"
];

const probabilityPool = [
  { prize: rewards[0], weight: 75 },
  { prize: rewards[1], weight: 15 },
  { prize: rewards[2], weight: 8 },
  { prize: rewards[3], weight: 2 }
];

let currentRotation = 0;

/* ç”»è½¬ç›˜ï¼ˆåªç”»ï¼Œä¸è½¬ï¼‰ */
function drawWheel(){
  const arc = Math.PI * 2 / rewards.length;
  const colors = ["#FFD966","#7FDBB6","#74B9FF","#FF7675"];

  ctx.clearRect(0,0,300,300);

  rewards.forEach((text,i)=>{
    ctx.beginPath();
    ctx.fillStyle = colors[i];
    ctx.moveTo(150,150);
    ctx.arc(
      150,
      150,
      150,
      arc*i - Math.PI/2,
      arc*(i+1) - Math.PI/2
    );
    ctx.fill();

    ctx.save();
    ctx.translate(150,150);
    ctx.rotate(arc*i + arc/2 - Math.PI/2);
    ctx.textAlign="right";
    ctx.font="bold 13px Arial";
    ctx.fillStyle="#333";
    ctx.fillText(text,140,5);
    ctx.restore();
  });
}

function weightedRandom(){
  let total = probabilityPool.reduce((s,p)=>s+p.weight,0);
  let r = Math.random()*total;
  for(const p of probabilityPool){
    if(r<p.weight) return p.prize;
    r-=p.weight;
  }
}

spinBtn.onclick = (e) => {
  e.preventDefault();   // â­ å…³é”®ï¼é˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º
  e.stopPropagation();

  const debtor = debtorInput.value.trim();
  if (!debtor) {
    alert("è¯·è¾“å…¥ Debtor Code");
    return;
  }

  const key = "EVO_SPIN_" + debtor + "_" + invoice;
  if (localStorage.getItem(key)) {
    alert("Debtor å·²å‚ä¸è¿‡ ğŸ™");
    return;
  }
  const invoice = invoiceInput.value.trim().toUpperCase();

  // Invoice æ ¼å¼ï¼šIV + 5 ä¸ªæ•°å­—
  const invoiceRegex = /^IV\d{5}$/;

  if (!invoiceRegex.test(invoice)) {
    alert("Invoice æ ¼å¼ä¸æ­£ç¡®ã€‚\næ­£ç¡®æ ¼å¼ï¼šIV12345");
    return;
  }
  
  const result = weightedRandom();
  const index = rewards.indexOf(result);
  const arc = 360 / rewards.length;
  const targetAngle = index * arc + arc / 2;

  currentRotation += 360 * 5 - targetAngle;
  wheelWrapper.style.transform = `rotate(${currentRotation}deg)`;

  spinBtn.disabled = true;
  spinBtn.textContent = "Memutar...";
  localStorage.setItem(key, "played");

  setTimeout(() => {
    const form = document.getElementById("gasForm");
    form.debtor.value = debtor;
    form.invoice.value = invoice;
    form.reward.value = result;
    form.submit();   // åªå…è®¸è¿™ä¸€è¡Œ submit

    alert(
      "ğŸ‰ Tahniah!\n\n" +
      "Kod Debtor: " + debtor +
      "\n\nHadiah Anda:\n" + result
    );

    spinBtn.textContent = "Sudah Menyertai";
  }, 4200);


};

drawWheel();
</script>

</body>
</html>



























