<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>EVO Roda Bertuah</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.container {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 20px;
  padding: 40px 30px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  max-width: 500px;
  width: 100%;
  backdrop-filter: blur(10px);
}

h1 {
  font-size: 32px;
  color: #333;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.subtitle {
  color: #666;
  font-size: 14px;
  margin-bottom: 30px;
  padding: 8px 16px;
  background: #ffeaa7;
  border-radius: 20px;
  display: inline-block;
}

.input-group {
  margin-bottom: 30px;
}

input {
  padding: 16px 20px;
  font-size: 16px;
  width: 100%;
  border: 2px solid #ddd;
  border-radius: 12px;
  transition: all 0.3s;
  outline: none;
}

input:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

#wheel-container {
  position: relative;
  width: 320px;
  height: 320px;
  margin: 0 auto 30px;
}

#wheel {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border: 10px solid #333;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3), inset 0 0 20px rgba(0,0,0,0.1);
  transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
}

.pointer {
  position: absolute;
  top: -15px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-bottom: 35px solid #ff3838;
  filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
  z-index: 10;
}

.pointer::after {
  content: '';
  position: absolute;
  top: 35px;
  left: -8px;
  width: 16px;
  height: 16px;
  background: #ff3838;
  border-radius: 50%;
}

.center-circle {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  border-radius: 50%;
  border: 4px solid white;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  z-index: 5;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

button {
  padding: 18px 40px;
  font-size: 20px;
  font-weight: bold;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  width: 100%;
  transition: all 0.3s;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
  text-transform: uppercase;
  letter-spacing: 1px;
}

button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 12px 25px rgba(102, 126, 234, 0.5);
}

button:active:not(:disabled) {
  transform: translateY(0);
}

button:disabled {
  background: #ccc;
  cursor: not-allowed;
  box-shadow: none;
}

.footer {
  font-size: 12px;
  color: #999;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #eee;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.spin-animation {
  animation: pulse 0.5s ease-in-out;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 480px) {
  .container {
    padding: 30px 20px;
  }
  
  h1 {
    font-size: 26px;
  }
  
  #wheel-container {
    width: 280px;
    height: 280px;
  }
  
  button {
    font-size: 18px;
  }
}
</style>
</head>

<body>

<div class="container">
  <h1>ğŸ‰ EVO Roda Bertuah ğŸ‰</h1>
  <div class="subtitle">Kedai Baharu Sahaja Â· 1 Kali Setiap Debtor</div>

  <div class="input-group">
    <input type="text" id="debtorCode" placeholder="Sila masukkan Kod Debtor" />
  </div>

  <div id="wheel-container">
    <div class="pointer"></div>
    <canvas id="wheel" width="320" height="320"></canvas>
    <div class="center-circle">ğŸ</div>
  </div>

  <button id="spinBtn">Putar Sekarang</button>

  <div class="footer">
    Aktiviti ini terhad untuk kedai baharu sahaja Â· Hadiah mengikut rekod sistem<br>
    Semua hadiah akan diberikan semasa pesanan seterusnya
  </div>
</div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const debtorInput = document.getElementById("debtorCode");

/* =========================
   ğŸ REWARD CONFIG åŒº
   ğŸ‘‰ ä½ ä¹‹ååªéœ€è¦æ”¹è¿™é‡Œ
========================= */
const rewards = [
  "ğŸ Percuma Touro 12 - 1 karton",
  "ğŸ Percuma Luffman Evo - 2 paket",
  "ğŸ Percuma Sukun (Merah/Putih) - 2 paket",
  "ğŸ Percuma Luffman Evo - 1 karton",
  "ğŸ Percuma Luffman Nano Watermelon - 1 paket"
];

/* æ¦‚ç‡æ§åˆ¶ */
const probabilityPool = [
  { prize: rewards[0], weight: 1 },   // Touro 12 - 1%
  { prize: rewards[1], weight: 20 },  // Luffman Evo 2 paket - 20%
  { prize: rewards[2], weight: 20 },  // Sukun 2 paket - 20%
  { prize: rewards[3], weight: 20 },  // Luffman Evo 1 carton - 20%
  { prize: rewards[4], weight: 39 }   // Nano Watermelon - 39%
];

let currentRotation = 0;

function drawWheel() {
  const arc = Math.PI * 2 / rewards.length;
  const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#C7CEEA'];
  
  rewards.forEach((text, i) => {
    ctx.beginPath();
    ctx.fillStyle = colors[i];
    ctx.moveTo(160, 160);
    ctx.arc(160, 160, 160, arc * i, arc * (i + 1));
    ctx.fill();
    
    // æ·»åŠ è¾¹æ¡†çº¿
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.save();
    ctx.translate(160, 160);
    ctx.rotate(arc * i + arc / 2);
    ctx.textAlign = "right";
    ctx.font = "bold 13px Arial";
    ctx.fillStyle = "#333";
    
    // æ–‡å­—é˜´å½±æ•ˆæœ
    ctx.shadowColor = 'rgba(255,255,255,0.5)';
    ctx.shadowBlur = 3;
    ctx.shadowOffsetX = 1;
    ctx.shadowOffsetY = 1;
    
    // åˆ†è¡Œæ˜¾ç¤ºæ–‡å­—
    const lines = text.split(' - ');
    ctx.fillText(lines[0], 150, -8);
    if (lines[1]) {
      ctx.font = "11px Arial";
      ctx.fillText(lines[1], 150, 8);
    }
    
    ctx.restore();
  });
}

function weightedRandom() {
  let total = probabilityPool.reduce((s, p) => s + p.weight, 0);
  let rand = Math.random() * total;
  for (let p of probabilityPool) {
    if (rand < p.weight) return p.prize;
    rand -= p.weight;
  }
}

spinBtn.onclick = () => {
  const debtor = debtorInput.value.trim();
  if (!debtor) {
    alert("âš ï¸ Sila masukkan Kod Debtor terlebih dahulu");
    debtorInput.focus();
    return;
  }

  const key = "EVO_SPIN_" + debtor;
  if (localStorage.getItem(key)) {
    alert("âŒ Debtor ini sudah menyertai aktiviti\nSetiap Debtor hanya boleh menyertai 1 kali sahaja ğŸ™");
    return;
  }

  const result = weightedRandom();
  const index = rewards.indexOf(result);
  const arc = 360 / rewards.length;

  const rotation = 360 * 5 + (360 - (index * arc + arc / 2));

  currentRotation += rotation;
  canvas.style.transform = `rotate(${currentRotation}deg)`;

  spinBtn.disabled = true;
  spinBtn.textContent = "Memutar...";
  localStorage.setItem(key, "played");

  setTimeout(() => {
    // è®°å½•åˆ° Google Sheet
    fetch("https://script.google.com/macros/s/AKfycbyOEKmkjczMpTcBGUXBoVMrv5IuhAuNro4upiT85ueONZ6P2FXcp9zOJCeYCrOAcZi4/exec", {
      method: "POST",
      body: JSON.stringify({
        debtor: debtor,
        reward: result,
        timestamp: new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Kuala_Lumpur' })
      })
    }).catch(err => console.error('è®°å½•å¤±è´¥:', err));

    // æ˜¾ç¤ºä¸­å¥–ç»“æœ
    alert(
      "ğŸ‰ğŸ‰ğŸ‰ Tahniah! Anda Menang! ğŸ‰ğŸ‰ğŸ‰\n\n" +
      "Kod Debtor: " + debtor + "\n\n" +
      "ğŸ Hadiah Anda:\n" + result.replace('ğŸ ', '') + "\n\n" +
      "Hadiah akan diberikan bersama pesanan seterusnya!\n" +
      "Terima kasih atas penyertaan anda ğŸ’"
    );
    
    spinBtn.textContent = "Sudah Menyertai";
  }, 4200);
};

drawWheel();
</script>

</body>
</html>